"use strict";(globalThis.webpackChunkgoogle_listings_and_ads=globalThis.webpackChunkgoogle_listings_and_ads||[]).push([[528],{529:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Je});var r=a(1609),s=a(7723),n=a(6087),l=a(6476),o=a(7143),i=a(6520),c=a(7615);function d(e=""){return[...new Set(e.split(",").map((e=>parseInt(e,10))).filter((e=>!isNaN(e))))]}function g(e,t={},a={}){return e.reduce(((e,r)=>(e[r]=(t[r]||0)+(a[r]||0),e)),{})}function u(e,t){if(!t)return e||null;if(!e)return t;const a=new Map(e.map((e=>[e.interval,e.subtotals]))),r=new Map(t.map((e=>[e.interval,e.subtotals])));return[...new Set([...a.keys(),...r.keys()])].sort().map((e=>({interval:e,subtotals:g(c.YK,a.get(e),r.get(e))})))}function p(e,t={},a){const r=e?Object.keys(e):a;return e=e||{},r.reduce(((r,s)=>{let n=c.XQ.NONE,l=e[s];return a&&(a.includes(s)?void 0===t[s]?n=c.XQ.FOR_REQUEST:l=(e[s]||0)+t[s]:n=c.XQ.FOR_METRIC),{...r,[s]:(0,c.jr)(l,void 0,n)}}),{})}var m=a(2775),h=a(3905);const y="programs",f={free_listings:[],campaigns:[],intervals:[],totals:{}},_={loaded:!0,data:{},reportQuery:null};function b(e,t,a){const r=d(t[h.s_]),s=0===r.length||r.includes(h.Q),n=(0===r.length||r.some((e=>e!==h.Q)))&&h.Th.adsSetupComplete;return{free:s&&e(y,"free",t,a)||_,paid:n&&e(y,"paid",t,a)||_}}var v=a(3772),S=a(7419);const E=(0,s.__)("Unavailable","google-listings-and-ads");function k(e){const{formatNumber:t}=(0,v.A)(),{formatAmount:a}=(0,S.A)();return(0,n.useMemo)((()=>{function r(e){return void 0===e?E:this.isCurrency?a(e,!0):t(e,0)}return e.map((e=>({...e,formatFn:r})))}),[e,t,a])}var C=a(2047),F=a(5462),w=a(8468),A=a(7374),T=a(5703);const P=[{id:h.Q,name:(0,s.__)("Free Listings","google-listings-and-ads")}],L=new Set(P.map((e=>e.id)));var Q=a(1209),q=a(3175),M=a.n(q),N=a(4111),D=a.n(N),R=a(8846),x=a(6427),I=a(6459);class B extends n.Component{constructor({getLabels:e,param:t,query:a}){super(...arguments),this.state={selected:[]},this.clearQuery=this.clearQuery.bind(this),this.updateQuery=this.updateQuery.bind(this),this.updateLabels=this.updateLabels.bind(this),this.onButtonClicked=this.onButtonClicked.bind(this),a[t]&&e(a[t],a).then(this.updateLabels)}componentDidUpdate({param:e,query:t},{selected:a}){const{getLabels:r,param:s,query:n}=this.props,{selected:o}=this.state;if(e!==s||a.length>0&&0===o.length)return void this.clearQuery();const i=(0,l.getIdsFromQuery)(t[s]),c=(0,l.getIdsFromQuery)(n[s]);(0,w.isEqual)(i.sort(),c.sort())||r(n[s],n).then(this.updateLabels)}clearQuery(){const{param:e,path:t,query:a}=this.props;this.setState({selected:[]}),(0,l.updateQueryString)({[e]:void 0},t,a)}updateLabels(e){this.setState({selected:e})}updateQuery(){const{param:e,path:t,query:a}=this.props,{selected:r}=this.state,s=r.map((e=>e.key));(0,l.updateQueryString)({[e]:s.join(",")},t,a)}onButtonClicked(e){this.updateQuery(e),(0,w.isFunction)(this.props.onClick)&&this.props.onClick(e)}render(){const{labels:e,type:t,autocompleter:a}=this.props,{selected:n}=this.state;return(0,r.createElement)(x.Card,{className:"woocommerce-filters__compare"},(0,r.createElement)(x.CardHeader,null,(0,r.createElement)(I.A,{variant:"subtitle-small"},e.title)),(0,r.createElement)(x.CardBody,null,(0,r.createElement)(R.Search,{autocompleter:a,type:t,selected:n,placeholder:e.placeholder,onChange:e=>{this.setState({selected:e})}})),(0,r.createElement)(x.CardFooter,{justify:"flex-start"},(0,r.createElement)(R.CompareButton,{count:n.length,helpText:e.helpText,onClick:this.onButtonClicked},e.update),n.length>0&&(0,r.createElement)(x.Button,{isLink:!0,onClick:this.clearQuery},(0,s.__)("Clear all","woocommerce"))))}}B.propTypes={getLabels:M().func.isRequired,labels:M().shape({placeholder:M().string,title:M().string,update:M().string}),param:M().string.isRequired,path:M().string.isRequired,query:M().object,type:M().string.isRequired,autocompleter:M().object},B.defaultProps={labels:{},query:{}};var O=a(8107),V=a(6942),j=a.n(V),K=a(7677),U=a(3988);const G="all";class z extends n.Component{constructor(e){super(e);const t=this.getFilter();if(this.state={nav:t.path||[],animate:null,selectedTag:null},this.selectSubFilter=this.selectSubFilter.bind(this),this.getVisibleFilters=this.getVisibleFilters.bind(this),this.updateSelectedTag=this.updateSelectedTag.bind(this),this.onTagChange=this.onTagChange.bind(this),this.onContentMount=this.onContentMount.bind(this),this.goBack=this.goBack.bind(this),t.settings&&t.settings.getLabels){const{query:e}=this.props,{param:a,getLabels:r}=t.settings;r(e[a],e).then(this.updateSelectedTag)}}componentDidUpdate({query:e}){const{query:t,config:a}=this.props;if(e[a.param]!==t[[a.param]]){const e=this.getFilter();if(e&&"Search"===e.component){this.setState({nav:e.path||[]});const{param:a,getLabels:r}=e.settings;r(t[a],t).then(this.updateSelectedTag)}}}updateSelectedTag(e){this.setState({selectedTag:e[0]})}getFilter(e){const{config:t,query:a}=this.props,r=(0,l.flattenFilters)(t.filters);return e=e||a[t.param]||t.defaultValue||G,(0,w.find)(r,{value:e})||{}}getButtonLabel(e){if("Search"===e.component){const{selectedTag:t}=this.state;return[t&&t.label,(0,w.get)(e,"settings.labels.button")]}return e?[e.label]:[]}getVisibleFilters(e,t){if(0===t.length)return e;const a=t[0],r=(0,w.find)(e,{value:a});return this.getVisibleFilters(r&&r.subFilters,t.slice(1))}selectSubFilter(e){this.setState((t=>({nav:[...t.nav,e],animate:"left"})))}goBack(){this.setState((e=>({nav:e.nav.slice(0,-1),animate:"right"})))}update(e,t={}){const{path:a,query:r,config:s,onFilterSelect:n}=this.props,o=(0,l.getPersistedQuery)(r),i={[s.param]:(s.defaultValue||G)===e?void 0:e,...t};s.staticParams.forEach((e=>{i[e]=r[e]})),(0,l.updateQueryString)(i,a,o),n(i)}onTagChange(e,t,a,r){const s=(0,w.last)(r),{value:n,settings:l}=e,{param:o}=l;s?(this.update(n,{[o]:s.key}),t()):this.update(a.defaultValue||G),this.updateSelectedTag([s])}renderButton(e,t,a){if(e.component){const{type:s,labels:n,autocompleter:l}=e.settings,o=this.getFilter().value===e.value?this.state.selectedTag:null;return(0,r.createElement)(R.Search,{autocompleter:l,className:"woocommerce-filters-filter__search",type:s,placeholder:n.placeholder,selected:o?[o]:[],onChange:(0,w.partial)(this.onTagChange,e,t,a),inlineTags:!0,staticResults:!0})}const s=a=>{t(a),this.update(e.value,e.query||{}),this.setState({selectedTag:null})},n=(0,w.partial)(this.selectSubFilter,e.value),l=this.getFilter(),o=l.value===e.value||l.path&&(0,w.includes)(l.path,e.value);return(0,r.createElement)(x.Button,{className:"woocommerce-filters-filter__button",onClick:a=>{o?t(a):e.subFilters?n(a):s(a)}},e.label)}onContentMount(e){const{nav:t}=this.state,a=t.length&&this.getFilter(t[t.length-1])?1:0,r=O.focus.tabbable.find(e)[a];setTimeout((()=>{r.focus()}),0)}render(){const{config:e}=this.props,{nav:t,animate:a}=this.state,n=this.getVisibleFilters(e.filters,t),l=!!t.length&&this.getFilter(t[t.length-1]),o=this.getFilter();return(0,r.createElement)("div",{className:"woocommerce-filters-filter"},e.label&&(0,r.createElement)("span",{className:"woocommerce-filters-label"},e.label,":"),(0,r.createElement)(x.Dropdown,{contentClassName:"woocommerce-filters-filter__content",position:"bottom",expandOnMobile:!0,headerTitle:(0,s.__)("filter report to show:","woocommerce"),renderToggle:({isOpen:e,onToggle:t})=>(0,r.createElement)(R.DropdownButton,{onClick:t,isOpen:e,labels:this.getButtonLabel(o)}),renderContent:({onClose:s})=>(0,r.createElement)(R.AnimationSlider,{animationKey:t,animate:a,onExited:this.onContentMount},(()=>(0,r.createElement)("ul",{className:"woocommerce-filters-filter__content-list"},l&&(0,r.createElement)("li",{className:"woocommerce-filters-filter__content-list-item"},(0,r.createElement)(x.Button,{className:"woocommerce-filters-filter__button",onClick:this.goBack},(0,r.createElement)(K.A,{icon:U.A}),l.label)),n.map((t=>(0,r.createElement)("li",{key:t.value,className:j()("woocommerce-filters-filter__content-list-item",{"is-selected":o.value===t.value||o.path&&(0,w.includes)(o.path,t.value)})},this.renderButton(t,s,e)))))))}))}}z.propTypes={config:M().shape({label:M().string,staticParams:M().array.isRequired,param:M().string.isRequired,defaultValue:M().string,showFilters:M().func.isRequired,filters:M().arrayOf(M().shape({chartMode:M().oneOf(["item-comparison","time-comparison"]),component:M().string,label:M().string,path:M().string,subFilters:M().array,value:M().string.isRequired}))}).isRequired,path:M().string.isRequired,query:M().object,onFilterSelect:M().func},z.defaultProps={query:{},onFilterSelect:()=>{}};const H=z;class X extends n.Component{constructor(){super(),this.renderCard=this.renderCard.bind(this),this.onRangeSelect=this.onRangeSelect.bind(this)}renderCard(e){const{siteLocale:t,advancedFilters:a,query:s,path:n,onAdvancedFilterAction:l,currency:o}=this.props,{filters:i,param:c}=e;if(!s[c])return null;if(0===s[c].indexOf("compare")){const e=(0,w.find)(i,{value:s[c]});if(!e)return null;const{settings:t={}}=e;return(0,r.createElement)("div",{key:c,className:"woocommerce-filters__advanced-filters"},(0,r.createElement)(B,{path:n,query:s,...t}))}return"advanced"===s[c]?(0,r.createElement)("div",{key:c,className:"woocommerce-filters__advanced-filters"},(0,r.createElement)(R.AdvancedFilters,{siteLocale:t,currency:o,config:a,path:n,query:s,onAdvancedFilterAction:l})):void 0}onRangeSelect(e){const{query:t,path:a,onDateSelect:r}=this.props;(0,l.updateQueryString)(e,a,t),r(e)}getDateQuery(e){const{period:t,compare:a,before:r,after:s}=(0,A.getDateParamsFromQuery)(e),{primary:n,secondary:l}=(0,A.getCurrentDates)(e);return{period:t,compare:a,before:r,after:s,primaryDate:n,secondaryDate:l}}render(){const{dateQuery:e,filters:t,query:a,path:l,showDatePicker:o,onFilterSelect:i,isoDateFormat:c}=this.props;return(0,r.createElement)(n.Fragment,null,(0,r.createElement)(R.H,{className:"screen-reader-text"},(0,s.__)("Filters","woocommerce")),(0,r.createElement)(R.Section,{component:"div",className:"woocommerce-filters"},(0,r.createElement)("div",{className:"woocommerce-filters__basic-filters"},o&&(0,r.createElement)(R.DateRangeFilterPicker,{key:JSON.stringify(a),dateQuery:e||this.getDateQuery(a),onRangeSelect:this.onRangeSelect,isoDateFormat:c}),t.map((e=>e.showFilters(a)?(0,r.createElement)(H,{key:e.param,config:e,query:a,path:l,onFilterSelect:i}):null))),t.map(this.renderCard)))}}X.propTypes={siteLocale:M().string,advancedFilters:M().object,filters:M().array,path:M().string.isRequired,query:M().object,showDatePicker:M().bool,onDateSelect:M().func,onFilterSelect:M().func,onAdvancedFilterAction:M().func,currency:M().object,dateQuery:M().shape({period:M().string.isRequired,compare:M().string.isRequired,before:M().object,after:M().object,primaryDate:M().shape({label:M().string.isRequired,range:M().string.isRequired}).isRequired,secondaryDate:M().shape({label:M().string.isRequired,range:M().string.isRequired})}),isoDateFormat:M().string},X.defaultProps={siteLocale:"en_US",advancedFilters:{},filters:[],query:{},showDatePicker:!0,onDateSelect:()=>{},currency:D()().getCurrencyConfig()};const Y=X;var J=a(6473);const $=(0,T.getSetting)("locale").siteLocale,W=(()=>{let e,t,a;function r(){e=null,a=new Promise((e=>{t=e})).then((()=>P.concat(e)))}r();const n={name:"programs",options:()=>a,getOptionIdentifier:e=>e.id,getOptionLabel:e=>e.name,getOptionKeywords:e=>[e.name],getOptionCompletion:e=>({key:e.id,label:e.name})};async function l(e){const t=new Set(d(e));let r;return r=function(e,t){if(e.size>t.size)return!1;for(const a of e)if(!t.has(a))return!1;return!0}(t,L)?P:(await a).filter((e=>t.has(e.id))),r.map((e=>({key:e.id,label:e.name})))}const o={label:(0,s.__)("Show","google-listings-and-ads"),staticParams:["period","chartType","paged","per_page","selectedMetric","reportKey","orderby","order"],param:"filter",showFilters:()=>!0,filters:[{label:(0,s.__)("All Google programs","google-listings-and-ads"),value:"all"},{label:(0,s.__)("Single program","google-listings-and-ads"),value:"select_program",subFilters:[{component:"Search",value:"single_program",path:["select_program"],settings:{type:"custom",param:h.s_,getLabels:l,labels:{placeholder:(0,s.__)("Type to search for a program","google-listings-and-ads"),button:(0,s.__)("Single Program","google-listings-and-ads")},autocompleter:n}}]},{label:(0,s.__)("Comparison","google-listings-and-ads"),chartMode:"item-comparison",value:"compare-programs",settings:{type:"custom",param:h.s_,getLabels:l,labels:{helpText:(0,s.__)("Check at least two programs below to compare","google-listings-and-ads"),placeholder:(0,s.__)("Search for programs to compare","google-listings-and-ads"),title:(0,s.__)("Compare Programs","google-listings-and-ads"),update:(0,s.__)("Compare","google-listings-and-ads")},autocompleter:n}}]};return({data:a,loaded:s})=>(s?(e&&e!==a&&r(),e=a,t()):e&&r(),o)})(),Z=e=>{const{query:t,trackEventId:a}=e,s=[W((0,Q.A)({exclude_removed:!1}))],{period:n,compare:l,before:o,after:i}=(0,A.getDateParamsFromQuery)(t),{primary:c,secondary:d}=(0,A.getCurrentDates)(t),g={period:n,compare:l,before:o,after:i,primaryDate:c,secondaryDate:d},u=(0,v.A)(),p={...t};return(0,r.createElement)(Y,{query:p,siteLocale:$,currency:u,filters:s,onDateSelect:e=>(0,J.ce)("gla_datepicker_update",{report:a,...(0,w.omitBy)(e,w.isUndefined)}),onFilterSelect:e=>(0,J.ce)("gla_filter",{report:a,filter:e.filter||"all"}),path:t.path,dateQuery:g,isoDateFormat:A.isoDateFormat})};var ee=a(4275),te=a(9039),ae=a(2848);const re="https://merchants.google.com/mc/reporting/dashboard",se=({href:e,selected:t,onLinkClickCallback:a,metric:l,data:{value:o,prevValue:i,delta:d,missingFreeListingsData:g}})=>{const u=(0,n.useMemo)((()=>({value:l.formatFn(o),prevValue:l.formatFn(i)})),[l,o,i]);let p=l.label;const m=[],h=[];if(g!==c.XQ.NONE){const e=(0,s.__)("This data is currently available for paid campaigns only.","google-listings-and-ads");m.push(e),h.push(e)}if(g===c.XQ.FOR_REQUEST){const e=(0,s.__)("Please try again later, or go to <googleMerchantCenterLink /> to track your performance for Google Free Listings.","google-listings-and-ads");m.push((0,n.createInterpolateElement)(e,{googleMerchantCenterLink:(0,r.createElement)(ae.A,{eventName:"gla_google_mc_link_click",eventProps:{context:"reports",href:re},type:"external",target:"_blank",href:re,onClick:e=>e.stopPropagation()},(0,s.__)("Google Merchant Center","google-listings-and-ads"))}));const t=(0,n.createInterpolateElement)(e,{googleMerchantCenterLink:(0,r.createElement)(r.Fragment,null,(0,s.sprintf)(
// translators: %s: link to Google Merchant Center.
// translators: %s: link to Google Merchant Center.
(0,s.__)("Google Merchant Center (%s)","google-listings-and-ads"),re))});h.push((0,n.renderToString)(t))}if(m.length>0){const e=m.map(((e,t)=>(0,r.createElement)("div",{className:"gla-reports__metric-info",key:t},e)));p=(0,r.createElement)("div",{className:"gla-reports__metric-label"},l.label,(0,r.createElement)(te.A,{text:e},(0,r.createElement)(ee.A,{className:"gla-reports__metric-infoicon",role:"img","aria-label":h.join(" "),size:16})))}return(0,r.createElement)(R.SummaryNumber,{label:p,href:e,selected:t,delta:d,onLinkClickCallback:a,...u})},ne={value:null,preValue:null,delta:null},le=({loaded:e,metrics:t,expectedLength:a=t.length,totals:s,trackEventId:n})=>{const o=(0,m.A)();if(!e)return(0,r.createElement)(R.SummaryListPlaceholder,{numberOfItems:a});const{selectedMetric:i=t[0].key}=o;return(0,r.createElement)(R.SummaryList,null,(()=>t.map((e=>{const{key:t}=e,a=i===t,o=(0,l.getNewPath)({selectedMetric:t});return(0,r.createElement)(se,{key:t,metric:e,href:o,selected:a,data:s[t]||ne,onLinkClickCallback:()=>{return e=t,void(0,J.ce)("gla_chart_tab_click",{report:n,context:e});var e}})}))))},oe=(0,s.__)("No data for the selected date range","google-listings-and-ads");function ie({metrics:e,loaded:t,intervals:a}){const s=(0,m.A)(),l=(0,v.A)(),{selectedMetric:o}=s;let i={};e.length&&(i=o&&e.find((e=>e.key===o))||e[0]);const{key:c,label:d,isCurrency:g=!1,formatFn:u}=i,p={...l,symbol:""},h=(0,A.getChartTypeForQuery)(s),y=g?"currency":"number",f=u.bind(i),_=(0,n.useMemo)((()=>t?a.map((({interval:e,subtotals:t})=>({date:e,[d]:{value:t[c],label:d}}))):[]),[c,d,t,a]);return(0,r.createElement)(R.Chart,{data:_,title:d,query:s,currency:p,chartType:h,valueType:y,tooltipValueFormat:f,isRequesting:!t,emptyMessage:oe,layout:"time-comparison",legendPosition:"hidden"})}var ce=a(7892),de=a(8237);const ge=({compareBy:e,compareParam:t,metrics:a,isLoading:o,compareButonTitle:i,data:c,nameHeader:g,nameCell:u,...p})=>{const h=(0,m.A)(),[y,f]=(0,n.useState)((()=>new Set(d(h[e])))),_=c.length||5,b=(0,n.useMemo)((()=>{if(!a.length)return[];const e=a.map((e=>({...e,isSortable:!0,isNumeric:!0})));return e[0].defaultSort=!0,e[0].defaultOrder="desc",e}),[a]),v=e=>a.map((t=>{const a=e.subtotals[t.key];return{display:t.formatFn(a)}})),S=(e,t)=>{t?f(new Set([...y,e])):(y.delete(e),f(new Set(y)))};return(0,r.createElement)(de.A,{actions:(0,r.createElement)(ce.A,{isSecondary:!0,disabled:o||y.size<=1,title:i,onClick:()=>{const a=Array.from(y).join(",");(0,l.onQueryChange)("compare")(e,t,a)}},(0,s.__)("Compare","google-listings-and-ads")),isLoading:o,headers:(E=c,[{key:"compare",label:(0,r.createElement)(x.CheckboxControl,{disabled:o,checked:!o&&E.length&&y.size===E.length,onChange:e=>{if(e){const e=c.map((e=>e.id));f(new Set(e))}else f(new Set)}}),required:!0},{key:"title",label:g,isLeftAligned:!0,required:!0},...b]),rows:(e=>e.map((e=>[{display:(0,r.createElement)(x.CheckboxControl,{checked:y.has(e.id),onChange:S.bind(null,e.id)})},{display:u(e)},...v(e)])))(c),totalRows:c.length,rowsPerPage:_,query:h,compareBy:e,compareParam:t,onQueryChange:l.onQueryChange,onSort:(0,l.onQueryChange)("sort"),...p});var E},ue=({isConverted:e,name:t})=>e?(0,r.createElement)("div",{className:"gla-reports__tooltip-campaign-name"},(0,r.createElement)(te.A,{placement:"top-start",text:(0,s.__)("This campaign has been upgraded to Performance Max","google-listings-and-ads")},t)):t,pe=({isLoading:e,orderby:t,order:a,metrics:l,freeListings:o,campaigns:i,...c})=>{const d=(0,n.useMemo)((()=>{if(e)return[];if(!o||0===o.length)return i;const r=[{...o[0],name:(0,s.__)("Free Listings","google-listings-and-ads"),id:h.Q},...i];return i.length&&(r.sort(((e,a)=>(e.subtotals[t]||Number.NEGATIVE_INFINITY)-(a.subtotals[t]||Number.NEGATIVE_INFINITY))),"desc"===a&&r.reverse()),r}),[e,o,i,t,a]);return(0,r.createElement)(ge,{title:(0,s.__)("Programs","google-listings-and-ads"),compareButonTitle:(0,s.__)("Select one or more programs to compare","google-listings-and-ads"),nameHeader:(0,s.__)("Program","google-listings-and-ads"),nameCell:ue,compareBy:"programs",compareParam:"filter",metrics:l,isLoading:e,data:d,...c})};var me=a(347),he=a(5535),ye=a(1670),fe=a(9269);const _e=[{key:"programs",title:(0,s.__)("Programs","google-listings-and-ads"),href:(0,l.getNewPath)({reportKey:"programs"},"/google/reports",{})},{key:"products",title:(0,s.__)("Products","google-listings-and-ads"),href:(0,l.getNewPath)({reportKey:"products"},"/google/reports",{})}],be=()=>{const e=(0,he.A)(),t=(0,fe.A)();return e?(0,r.createElement)(me.A,{tabs:_e,selectedKey:t}):(0,r.createElement)(ye.A,{tabs:_e,selectedKey:t})};var ve=a(5246);const Se=[{key:"sales",label:(0,s.__)("Total Sales","google-listings-and-ads"),isCurrency:!0},{key:"conversions",label:(0,s.__)("Conversions","google-listings-and-ads")},{key:"clicks",label:(0,s.__)("Clicks","google-listings-and-ads")},{key:"impressions",label:(0,s.__)("Impressions","google-listings-and-ads")}],Ee=[...Se,{key:"spend",label:(0,s.__)("Total Spend","google-listings-and-ads"),isCurrency:!0}],ke=[...Se,{key:"spend",label:(0,s.__)("Spend","google-listings-and-ads"),isCurrency:!0}],Ce=()=>{const e="reports-programs",{loaded:t,data:{totals:a,intervals:s,freeListings:d,campaigns:g},reportQuery:{fields:h,orderby:y,order:_}}=function(){const e=(0,m.A)(),{paid:t,free:a}=(0,o.useSelect)((t=>{const{getReport:a}=t(i.Ui);return b(a,e,"primary")}),[e]),r=t.loaded&&a.loaded,s=t.reportQuery||a.reportQuery,l=a.reportQuery?.fields,c=(0,n.useMemo)((()=>{const e=a.data,s=t.data;return r&&s&&e?{freeListings:e.free_listings||f.free_listings,campaigns:s.campaigns||f.campaigns,intervals:u(s.intervals,e.intervals)||f.intervals,totals:p(s.totals,e.totals,l)}:f}),[r,t.data,a.data,l]);return{loaded:r,reportQuery:s,data:c}}(),v=(0,n.useMemo)((()=>{const e=t&&Object.keys(a).length>0;return{available:e?Ee.filter((({key:e})=>a.hasOwnProperty(e))):Ee.filter((({key:e})=>h.includes(e))),expected:e?ke.filter((({key:e})=>a.hasOwnProperty(e))):ke.filter((({key:e})=>h.includes(e)))}}),[t,a,h]),S=k(v.available),E=k(v.expected),{loaded:w,data:A}=function(e){const t=(0,m.A)(),{loaded:a,data:r}=function(e){const{paid:t,free:a}=(0,o.useSelect)((t=>{const{getReport:a}=t(i.Ui);return b(a,e,"secondary")}),[e]),r=t.loaded&&a.loaded,s=a.reportQuery?.fields,l=(0,n.useMemo)((()=>{const e=a.data,n=t.data;return r&&n&&e?p(n.totals,e.totals,s):f.totals}),[r,t.data,a.data,s]);return{loaded:r,data:l}}(t),s=(0,n.useMemo)((()=>a?function(e,t){return Object.keys(e).reduce(((a,r)=>({...a,[r]:(0,c.jr)(e[r].value,t[r]?.value,e[r].missingFreeListingsData)})),{})}(e,r):e),[a,r,e]);return{loaded:a,data:s}}(a),T=w?A:a;return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(C.A,{context:e}),(0,r.createElement)(F.A,null),(0,r.createElement)(ve.A,null),(0,r.createElement)(be,null),(0,r.createElement)(Z,{query:(0,l.getQuery)(),trackEventId:e}),(0,r.createElement)(le,{loaded:t,metrics:S,expectedLength:Ee.length,totals:T,trackEventId:e}),(0,r.createElement)(ie,{metrics:S,loaded:t,intervals:s}),(0,r.createElement)(pe,{trackEventReportId:e,isLoading:!t,orderby:y,order:_,metrics:E,freeListings:d,campaigns:g}))},Fe="products",we={products:[],intervals:[],totals:{}};var Ae=a(3741),Te=a(314),Pe=a(2619),Le=a(3832),Qe=a(1455),qe=a.n(Qe);function Me(e,t=w.identity){return function(a="",r){const s="function"==typeof e?e(r):e,n=(0,l.getIdsFromQuery)(a);if(n.length<1)return Promise.resolve([]);const o={include:n.join(","),per_page:n.length};return qe()({path:(0,Le.addQueryArgs)(s,o)}).then((e=>e.map(t)))}}const Ne=Me(Te.NAMESPACE+"/products",(e=>({key:e.id,label:e.name,type:e.type})));function De({attributes:e,name:t}){const a=(0,T.getSetting)("admin")?.variationTitleAttributesSeparator||" - ";if(t.indexOf(a)>-1)return t;const r=e.map((({option:e})=>e)).join(", ");return r?t+a+r:t}const Re=Me((({products:e})=>e?Te.NAMESPACE+`/products/${e}/variations`:Te.NAMESPACE+"/variations"),(e=>({key:e.id,label:De(e)}))),xe={label:(0,s.__)("Show","google-listings-and-ads"),staticParams:[h.DA,"chartType","orderby","order","paged","per_page","selectedMetric","reportKey"],param:"filter",showFilters:()=>!0,filters:[{label:(0,s.__)("All Products","google-listings-and-ads"),value:"all"},{label:(0,s.__)("Single Product","google-listings-and-ads"),value:"select_product",chartMode:"item-comparison",subFilters:[{component:"Search",value:"single-product",chartMode:"item-comparison",path:["select_product"],settings:{type:"products",param:"products",getLabels:Ne,labels:{placeholder:(0,s.__)("Type to search for a product","google-listings-and-ads"),button:(0,s.__)("Single Product","google-listings-and-ads")}}}]},{label:(0,s.__)("Comparison","google-listings-and-ads"),value:"compare-products",chartMode:"item-comparison",settings:{type:"products",param:"products",getLabels:Ne,labels:{helpText:(0,s.__)("Check at least two products below to compare","google-listings-and-ads"),placeholder:(0,s.__)("Search for products to compare","google-listings-and-ads"),title:(0,s.__)("Compare Products","google-listings-and-ads"),update:(0,s.__)("Compare","google-listings-and-ads")}}}]},Ie={showFilters:e=>"single-product"===e.filter&&!!e.products&&e["is-variable"],staticParams:["filter","products","chartType","orderby","order","paged","per_page","selectedMetric","reportKey"],param:"filter-variations",filters:[{label:(0,s.__)("All Variations","google-listings-and-ads"),chartMode:"item-comparison",value:"all"},{label:(0,s.__)("Single Variation","google-listings-and-ads"),value:"select_variation",subFilters:[{component:"Search",value:"single-variation",path:["select_variation"],settings:{type:"variations",param:"variations",getLabels:Re,labels:{placeholder:(0,s.__)("Type to search for a variation","google-listings-and-ads"),button:(0,s.__)("Single Variation","google-listings-and-ads")}}}]},{label:(0,s.__)("Comparison","google-listings-and-ads"),chartMode:"item-comparison",value:"compare-variations",settings:{type:"variations",param:"variations",getLabels:Re,labels:{helpText:(0,s.__)("Check at least two variations below to compare","google-listings-and-ads"),placeholder:(0,s.__)("Search for variations to compare","google-listings-and-ads"),title:(0,s.__)("Compare Variations","google-listings-and-ads"),update:(0,s.__)("Compare","google-listings-and-ads")}}}]},Be={label:(0,s.__)("Show data from","google-listings-and-ads"),param:h.DA,staticParams:["filter","products","orderby","order","chartType","selectedMetric","reportKey"],defaultValue:h.r6,filters:[{value:h.Mx,label:(0,s.__)("Paid campaigns","google-listings-and-ads")},{value:h.k1,label:(0,s.__)("Free listings","google-listings-and-ads")}],showFilters:({hasPaidSource:e})=>e},Oe=(0,Pe.applyFilters)("gla_products_report_filters",[xe,Ie,Be]),Ve=(0,Pe.applyFilters)("gla_products_report_advanced_filters",{}),je=(0,T.getSetting)("currency"),Ke=(0,T.getSetting)("locale").siteLocale,Ue=e=>{const{hasPaidSource:t,query:a,trackEventId:s}=e,{period:n,compare:l,before:i,after:c}=(0,A.getDateParamsFromQuery)(a),{primary:d,secondary:g}=(0,A.getCurrentDates)(a),u={period:n,compare:l,before:i,after:c,primaryDate:d,secondaryDate:g},p=(0,o.useSelect)((e=>{if(a.search||!a.products||1!==a.products.split(",").length)return!1;const t=parseInt(a.products,10),r={include:t},{getItems:s}=e(Te.ITEMS_STORE_NAME),n=s("products",r);return n&&n.get(t)&&"variable"===n.get(t).type}),[a.search,a.products]),m={...a,"is-variable":p,hasPaidSource:t};return(0,r.createElement)(R.ReportFilters,{query:m,siteLocale:Ke,currency:je,filters:Oe,advancedFilters:Ve,onDateSelect:e=>(0,J.ce)("gla_datepicker_update",{report:s,...(0,w.omitBy)(e,w.isUndefined)}),onFilterSelect:e=>(0,J.ce)("gla_filter",{report:s,filter:e.filter||"all",filterVariations:e["filter-variations"]}),dateQuery:u,isoDateFormat:A.isoDateFormat})},Ge=({metrics:e,isLoading:t,products:a,...n})=>(0,r.createElement)(ge,{title:(0,s.__)("Products","google-listings-and-ads"),compareButonTitle:(0,s.__)("Select one or more products to compare","google-listings-and-ads"),nameHeader:(0,s.__)("Product title","google-listings-and-ads"),nameCell:e=>e.name,compareBy:"products",compareParam:"filter",metrics:e,isLoading:t,data:a,...n}),ze=[{key:"clicks",label:(0,s.__)("Clicks","google-listings-and-ads")},{key:"impressions",label:(0,s.__)("Impressions","google-listings-and-ads")}],He=[{key:"sales",label:(0,s.__)("Total Sales","google-listings-and-ads"),isCurrency:!0},{key:"conversions",label:(0,s.__)("Conversions","google-listings-and-ads")},...ze,{key:"spend",label:(0,s.__)("Spend","google-listings-and-ads"),isCurrency:!0}],Xe=({hasPaidSource:e})=>{const t="reports-products",a=(0,l.getQuery)(),s=e?a[h.DA]||h.r6:h.k1,n=k(s===h.Mx?He:ze),{loaded:d,data:{totals:g,intervals:u,products:p}}=function(e){const t=(0,m.A)();return(0,o.useSelect)((a=>{const{getReport:r}=a(i.Ui),s=r(Fe,e,t,"primary"),n=r(Fe,e,t,"secondary"),l=s.loaded&&n.loaded;let o=we;return l&&s.data&&n.data&&(o={products:s.data.products||we.products,intervals:s.data.intervals||we.intervals,totals:(0,c.bM)(s.data.totals,n.data.totals,s.reportQuery.fields)}),{data:o,loaded:l}}),[e,t])}(s);return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(Ue,{hasPaidSource:e,query:a,trackEventId:t}),(0,r.createElement)(le,{metrics:n,loaded:d,totals:g,trackEventId:t}),(0,r.createElement)(ie,{metrics:n,loaded:d,intervals:u}),(0,r.createElement)(Ge,{trackEventReportId:t,metrics:n,isLoading:!d,products:p}))},Ye=()=>{const{loaded:e,data:t}=(0,Q.A)(),a=e&&t.some((({status:e})=>"enabled"===e));return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(C.A,{context:"reports-products"}),(0,r.createElement)(F.A,null),(0,r.createElement)(ve.A,null),(0,r.createElement)(be,null),e?(0,r.createElement)(Xe,{hasPaidSource:a}):(0,r.createElement)(Ae.A,null))},Je=()=>"products"===(0,fe.A)()?(0,r.createElement)(Ye,null):(0,r.createElement)(Ce,null)}}]);